<div class="container mx-auto max-w-4xl p-6">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-foreground text-3xl font-bold">Tasks</h1>
        <p class="text-muted-foreground">Manage your tasks and reminders</p>
    </div>

    <!-- Stats -->
    <div class="text-muted-foreground mb-6 flex gap-4 text-sm">
        <span>{{ stats().total }} total</span>
        <span>{{ stats().open }} open</span>
        <span>{{ stats().completed }} completed</span>
        @if (stats().overdue > 0) {
        <span class="text-destructive">{{ stats().overdue }} overdue</span>
        }
    </div>

    <!-- Controls -->
    <!-- Controls -->
    <div class="mb-6 flex flex-col gap-4 sm:flex-row sm:items-center">
        <!-- Search -->
        <div class="relative w-full sm:w-auto sm:flex-1">
            <ng-icon
                hlm
                name="lucideSearch"
                class="text-muted-foreground absolute top-1/2 left-3 -translate-y-1/2"
                size="sm" />
            <input
                hlmInput
                type="text"
                placeholder="Search tasks..."
                class="w-full pl-10"
                [value]="filter().searchTerm"
                (input)="onSearchChange($event)" />
        </div>

        <!-- Secondary Controls -->
        <div class="flex w-full items-center gap-2 sm:w-auto">
            <!-- Sort -->
            <brn-select
                class="flex-1 sm:w-40 sm:flex-none"
                [ngModel]="filter().sortBy"
                (ngModelChange)="onSortChange($event)">
                <hlm-select-trigger class="w-full sm:w-40">
                    <hlm-select-value placeholder="Sort by" />
                </hlm-select-trigger>
                <hlm-select-content>
                    @for (option of sortOptions; track option.value) {
                    <hlm-option [value]="option.value"> {{ option.label }} </hlm-option>
                    }
                </hlm-select-content>
            </brn-select>

            <!-- Sort Direction -->
            <button
                hlmBtn
                variant="outline"
                size="icon"
                [attr.aria-label]="filter().sortDirection === 'asc' ? 'Sort descending' : 'Sort ascending'"
                (click)="toggleSortDirection()">
                @if (filter().sortDirection === 'asc') {
                <ng-icon
                    hlm
                    name="lucideArrowDownAZ"
                    size="sm" />
                } @else {
                <ng-icon
                    hlm
                    name="lucideArrowUpAZ"
                    size="sm" />
                }
            </button>

            <!-- Add Task Button -->
            <button
                hlmBtn
                (click)="openCreateForm()">
                <ng-icon
                    hlm
                    name="lucidePlus"
                    size="sm" />
                Add Task
            </button>
        </div>
    </div>

    <!-- Task List -->
    <div class="space-y-3">
        @for (task of tasks(); track task.id) {
        <ra-task-item
            [task]="task"
            (toggleComplete)="toggleComplete($event)"
            (toggleImportant)="toggleImportant($event)"
            (edit)="openEditForm($event)"
            (delete)="deleteTask($event)" />
        } @empty {
        <div class="rounded-lg border border-dashed p-12 text-center">
            <p class="text-muted-foreground">No tasks found</p>
            <button
                hlmBtn
                variant="outline"
                class="mt-4"
                (click)="openCreateForm()">
                <ng-icon
                    hlm
                    name="lucidePlus"
                    size="sm" />
                Create your first task
            </button>
        </div>
        }
    </div>

    <!-- Task Form Modal -->
    @if (showForm()) {
    <ra-task-form
        [task]="editingTask()"
        (cancelEdit)="closeForm()" />
    }
    <hlm-alert-dialog [state]="deleteDialogOpen() ? 'open' : 'closed'">
        <hlm-alert-dialog-content *brnAlertDialogContent="let ctx">
            <hlm-alert-dialog-header>
                <h3 hlmAlertDialogTitle>Delete Task?</h3>
                <p hlmAlertDialogDescription>Are you sure you want to delete this task? This action cannot be undone.</p>
            </hlm-alert-dialog-header>
            <hlm-alert-dialog-footer>
                <button
                    hlmAlertDialogCancel
                    (click)="deleteDialogOpen.set(false)">
                    Cancel
                </button>
                <button
                    hlmAlertDialogAction
                    (click)="confirmDelete()">
                    Delete
                </button>
            </hlm-alert-dialog-footer>
        </hlm-alert-dialog-content>
    </hlm-alert-dialog>
</div>
